// Generated by CoffeeScript 1.9.1

/*
For: /user/help
 */

(function() {
  var FADE_TIME, REFRESH_SPEED, dtSettings_checkIns, refreshStatusCounts, socket;

  FADE_TIME = 100;

  dtSettings_checkIns = {
    order: [[0, 'asc']],
    aLengthMenu: [[50, 100, 150, -1], [50, 100, 150, "All"]],
    iDisplayLength: 25,
    autoWidth: true
  };

  socket = io('/admin/checkins');

  $(document).ready(function() {
    $('#DT-checkins').DataTable(dtSettings_checkIns);
    refreshStatusCounts();
    return setInterval(function() {
      return refreshStatusCounts();
    }, REFRESH_SPEED);
  });

  REFRESH_SPEED = 60000;

  refreshStatusCounts = function() {
    console.log('Refreshing status counts...');
    $('#loading img').fadeTo(FADE_TIME, 1);
    return $.ajax({
      type: 'POST',
      url: '/admin/checkins_getStatusCounts',
      data: JSON.stringify({}),
      contentType: 'application/json',
      success: function(res) {
        if (res.success) {
          console.log('Success counting status counts!');
          $('#expected').text('EXPECTED  ' + res.counts.expected);
          $('#checkedin').text('CHECKED IN  ' + res.counts.checkedIn);
          $('#noshow').text('NO SHOW  ' + res.counts.noShow);
        } else {
          console.log('Error counting status counts!');
          $('#expected').text('EXPECTED  ERR!');
          $('#checkedin').text('CHECKED IN  ERR!');
          $('#noshow').text('NO SHOW  ERR!');
        }
        $('#loading img').fadeTo(FADE_TIME, 0);
      },
      error: function() {
        console.log('Error retrieving status counts!');
        $('#expected').text('EXPECTED  ERR!');
        $('#checkedin').text('CHECKED IN  ERR!');
        $('#noshow').text('NO SHOW  ERR!');
        $('#loading img').fadeTo(FADE_TIME, 0);
      }
    });
  };

}).call(this);
