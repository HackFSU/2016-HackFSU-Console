// Generated by CoffeeScript 1.9.1

/*
For: /user/help
 */

(function() {
  var FADE_TIME, dtSettings_hidden, dtSettings_requests, hide, socket;

  FADE_TIME = 100;

  dtSettings_requests = {
    order: [[0, 'desc']],
    aLengthMenu: [[25, 50, 75, -1], [25, 50, 75, "All"]],
    iDisplayLength: 25,
    autoWidth: true
  };

  dtSettings_hidden = {
    order: [[0, 'desc']],
    aLengthMenu: [[25, 50, 75, -1], [25, 50, 75, "All"]],
    iDisplayLength: 25,
    autoWidth: true
  };

  socket = io('/user/help');

  $(document).ready(function() {
    var currTab, refreshTabs, tabHtml;
    currTab = [0, 0];
    tabHtml = {
      requests: $('#requests').wrap('<p/>').parent().html(),
      hidden: $('#hidden').wrap('<p/>').parent().html()
    };
    $('#tabContainer1').empty();
    $('#tabContainer0').empty();
    $('#tabContainer0').append(tabHtml.requests);
    socket.emit('test', 'klksjfkjslfjdf');
    $('button[name="hide"]').click(function() {
      console.log("clicked");
      hide($(this), $(this).attr('data-objectId'));
    });
    $('#DT-requests').DataTable(dtSettings_requests);
    refreshTabs = function() {
      $('a[role="tab"]').click(function(e) {
        var href;
        e.preventDefault();
        href = $(this).attr('href');
        switch (href) {
          case '#requests':
            if (currTab[0] !== 0) {
              $('#tabContainer0').empty();
              $('#tabContainer0').append(tabHtml.requests);
              $('button[name="hide"]').click(function() {
                hide($(this), $(this).attr('data-objectId'));
              });
              $('#DT-requests').DataTable(dtSettings_requests);
              return currTab[0] = 0;
            }
            break;
          case '#hidden':
            if (currTab[0] !== 1) {
              $('#tabContainer0').empty();
              $('#tabContainer0').append(tabHtml.hidden);
              $('#DT-hidden').DataTable(dtSettings_hidden);
              return currTab[0] = 1;
            }
            break;
          default:
            return console.log('Invalid tab id');
        }
      });
      return $(this).tab('show');
    };
    return refreshTabs();
  });

  hide = function($btn, objectId) {
    $('button[data-objectId="' + objectId + '"]').attr('disabled', 'disabled');
    $btn.text('...');
    $('#loading img').fadeTo(FADE_TIME, 1);
    console.log('Hiding ' + objectId);
    return $.ajax({
      type: 'POST',
      url: '/user/help_hide',
      data: JSON.stringify({
        objectId: objectId
      }),
      contentType: 'application/json',
      success: function(res) {
        console.log(JSON.stringify(res, void 0, 2));
        if (res.success) {
          $btn.text('Done!');
          $('button[data-objectId="' + objectId + '"]').closest('tr').remove();
          socket.emit('help hide', objectId);
        } else {
          $btn.text('Error!');
          $('button[data-objectId="' + objectId + '"]').removeAttr('disabled', 'disabled');
        }
        $('#loading img').fadeTo(FADE_TIME, 0);
      },
      error: function() {
        $btn.text('Error!');
        $('button[data-objectId="' + objectId + '"]').removeAttr('disabled', 'disabled');
      }
    });
  };

}).call(this);
