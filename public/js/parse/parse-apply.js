// Generated by CoffeeScript 1.8.0

/*
	Handles submission of application for /apply

	Dependencies:
		JQuery
	IDs
		-match parse ids except for QAs
		QA[0-5]
 */
var checkAppData;

$('#application').submit(function(event) {
  var appData, appValid;
  event.preventDefault();
  appData = {
    firstName: $('#firstName').val(),
    lastName: $('#lastName').val(),
    email: $('#email').val(),
    school: $('#school').val(),
    major: $('#major').val(),
    year: $('#year').val(),
    github: $('#github').val(),
    QAs: [$('input[type=radio][name=QA0][value=Yes]').is(':checked'), $('#QA1').val(), $('#QA2').val(), $('#QA3').val(), $('#QA4').val(), $('#QA5').val()]
  };
  console.log(JSON.stringify(appData));
  appValid = checkAppData(appData);
  if (appValid !== true) {

  } else {
    if (appValid === true) {
      $.ajax({
        type: 'post',
        url: '/apply_submit',
        data: appData,
        success: function(res) {
          console.log(JSON.stringify(res, void 0, 2));
          return alert("Application Submitted!");
        },
        error: function() {
          return alert("Error in submit!");
        }
      });
    }
  }
  console.log(appValid);
});


/*
 * Checks appdata for correct input. Returns true for valid,
 * or the form number for the first incorrect input (goes top down from 0)
 */

checkAppData = function(appData) {
  var re;
  re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  if (!appData.firstName.trim()) {
    return 0;
  }
  if (!appData.lastName.trim()) {
    return 1;
  }
  if (!appData.school.trim()) {
    return 2;
  }
  if (!(appData.email.trim() && re.test(appData.email))) {
    return 3;
  }
  if (!appData.year) {
    return 4;
  }
  if (!(appData.QAs[0] || $('input[type=radio][name=QA0][value=No]').is(':checked'))) {
    return 8;
  }
  return true;
};
