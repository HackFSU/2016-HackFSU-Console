// Generated by CoffeeScript 1.8.0

/*
	Submitting the email to parse
	
	Dependancies:
		Parse Javascript API
		JQuery
	IDs
		'previewEmailSubscribe'
	Notes
		This must be compiled to .js (alt+shift+c)
 */
var PARSE_APP_ID, PARSE_JAVASCRIPT_KEY, parseInitialized, saveFailure, saveSuccess, shake, submitEmail;

PARSE_APP_ID = 'jeoeVa2Nz3VLmrnWpAknbWKZADXHbmQltPSlU8mX';

PARSE_JAVASCRIPT_KEY = 'JoQ24unwktkQMuMvfOjH5KmZCfGswRDPbEiKa7Vz';

parseInitialized = false;

submitEmail = function(email) {
  var PreviewSubscription, prevSub;
  console.log('Submitting...');
  if (!parseInitialized) {
    Parse.initialize(PARSE_APP_ID, PARSE_JAVASCRIPT_KEY);
    parseInitialized = true;
  }
  PreviewSubscription = Parse.Object.extend('PreviewSubscription');
  prevSub = new PreviewSubscription();
  prevSub.set('email', email);
  return prevSub.save(null, {
    success: function(gameScore) {
      saveSuccess();
      return console.log('Save Successful');
    },
    failure: function(gameScore, error) {
      saveFailure();
      return console.log('Save Failed. Error: ' + error);
    }
  });
};

$('#previewEmailSubscribe').submit(function(event) {
  var $email, emailVal, isValidEmailInput, re;
  $email = $('#previewEmailSubscribe input[name=email]').val();
  re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  emailVal = re.test($email);
  console.log($email);
  if (emailVal) {
    isValidEmailInput = true;
    $('#submit').text('Saving Email');
    submitEmail($email);
  } else {
    shake();
    $('#email').val('');
    $('#email').attr('placeholder', 'Invalid Email');
  }
  return event.preventDefault();
});

shake = function() {
  var errField;
  errField = $('#previewEmailSubscribe');
  errField.addClass('shakeText');
  return errField.one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function(e) {
    return errField.removeClass('shakeText');
  });
};

saveFailure = function() {
  var errColor;
  errColor = '#BF4040';
  shake();
  $('#email').css('border-color', errColor);
  $('#submit').css('border-color', errColor);
  $('#submit').text('Get Notified');
  $('#email').val('');
  return $('#email').attr('placeholder', 'Submitting error. Please refresh.');
};

saveSuccess = function() {
  var sub;
  $('#email').fadeOut(1000, function() {
    return console.log('faded');
  });
  sub = $('#submit');
  return sub.fadeOut(1000, function() {
    sub.text('See you soon!');
    sub.attr('disabled', 'true');
    sub.removeClass('video-btn');
    sub.addClass('success-btn');
    return sub.fadeIn(1000, function() {});
  });
};
